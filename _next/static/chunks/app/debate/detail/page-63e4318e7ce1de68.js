(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{35321:(e,s,t)=>{Promise.resolve().then(t.bind(t,40251))},40251:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var l=t(72311),i=t(62847),a=t(78987);function r(e){let{title:s,thumbnail:t,choiceA:i,choiceB:a,onSelectSide:r,selectedSide:n,hasVote:c,isVoting:d=!1}=e;return(0,l.jsx)("div",{className:"mx-auto max-w-4xl px-4 py-8 md:px-8",children:(0,l.jsxs)("div",{className:"rounded-xl border-2 border-gray-200 bg-white p-6",children:[(0,l.jsx)("h1",{className:"mb-6 text-2xl font-bold text-gray-900",children:s}),(0,l.jsx)("div",{className:"overflow-hidden rounded-lg border border-gray-100",children:(0,l.jsx)("img",{src:t,alt:s,className:"h-64 w-full object-cover md:h-80"})}),(0,l.jsxs)("div",{className:"mt-8 flex flex-col gap-4 md:flex-row",children:[(0,l.jsx)("button",{onClick:()=>r("left"),disabled:null!==n||!0===c||d,className:"flex-1 rounded-lg px-6 py-4 text-lg font-semibold text-white transition-colors ".concat("left"===n?"bg-blue-600":null!==n||!0===c||d?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"),children:d?"투표 중...":i}),(0,l.jsx)("button",{onClick:()=>r("right"),disabled:null!==n||!0===c||d,className:"flex-1 rounded-lg px-6 py-4 text-lg font-semibold text-white transition-colors ".concat("right"===n?"bg-red-600":null!==n||!0===c||d?"bg-gray-400":"bg-red-500 hover:bg-red-600"),children:d?"투표 중...":a})]}),!0===c&&(0,l.jsx)("div",{className:"mt-4 text-center",children:(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"이미 투표하셨습니다."})}),d&&(0,l.jsx)("div",{className:"mt-4 text-center",children:(0,l.jsx)("p",{className:"text-sm text-blue-600",children:"투표를 처리하고 있습니다..."})})]})})}var n=t(30011),c=t(61915),d=t(65893),o=t(89014),m=t(29599);function x(e){let{agreeCount:s,disagreeCount:t}=e,i=s+t,a=Math.round(s/i*100),r=Math.round(t/i*100),x=[{name:"찬성",value:s,color:"#3B82F6"},{name:"반대",value:t,color:"#EF4444"}];return(0,l.jsxs)("div",{className:"rounded-xl border-2 border-gray-200 bg-white mx-auto max-w-4xl px-4 py-8 md:px-8",children:[(0,l.jsx)("h2",{className:"mb-6 text-xl font-bold text-gray-900",children:"투표 현황"}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-8 md:flex-row md:justify-between",children:[(0,l.jsx)("div",{className:"h-40 w-40 md:h-48 md:w-48",children:(0,l.jsx)(n.u,{width:"100%",height:"100%",children:(0,l.jsxs)(c.r,{children:[(0,l.jsx)(d.F,{data:x,cx:"50%",cy:"50%",innerRadius:50,outerRadius:65,paddingAngle:5,dataKey:"value",children:x.map((e,s)=>(0,l.jsx)(o.f,{fill:e.color},"cell-".concat(s)))}),(0,l.jsx)(m.s,{})]})})}),(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"h-4 w-4 rounded-full bg-blue-500"}),(0,l.jsxs)("span",{className:"text-lg font-medium text-gray-900",children:["찬성: ",s,"표 (",a,"%)"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"h-4 w-4 rounded-full bg-red-500"}),(0,l.jsxs)("span",{className:"text-lg font-medium text-gray-900",children:["반대: ",t,"표 (",r,"%)"]})]}),(0,l.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["총 ",i,"명이 투표했습니다"]})]})]})]})}var u=t(31594),h=t(29046);function p(e){var s;let{onSubmit:t,placeholder:a="댓글을 입력하세요...",isReply:r=!1}=e,[n,c]=(0,i.useState)(""),[d,o]=(0,i.useState)(!1),{isAuthenticated:m,user:x}=(0,u.w)(),{openLoginModal:p}=(0,h.X)();return(0,l.jsx)("div",{className:"".concat(r?"ml-12":""),children:(0,l.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),n.trim()){if(!m)return void p();t(n.trim()),c(""),o(!1)}},className:"space-y-3",children:(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[m&&x&&(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex-shrink-0 bg-gray-100 border border-gray-200 flex items-center justify-center text-base","aria-label":"내 프로필",children:x.profileEmoji||(null==(s=x.nickname)?void 0:s.charAt(0))}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("textarea",{value:n,onChange:e=>c(e.target.value),onFocus:()=>m&&o(!0),placeholder:m?a:"댓글을 작성하려면 로그인이 필요합니다.",disabled:!m,className:"w-full p-3 border rounded-lg resize-none transition-all ".concat(m?"border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200":"border-gray-200 bg-gray-50 cursor-not-allowed"," ").concat(d?"min-h-[100px]":"min-h-[44px]"),rows:d?3:1}),d&&m&&(0,l.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{c(""),o(!1)},className:"px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"취소"}),(0,l.jsxs)("button",{type:"submit",disabled:!n.trim(),className:"px-4 py-2 text-sm rounded-lg transition-colors ".concat(n.trim()?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:[r?"답글":"댓글"," 작성"]})]})]})]})})})}function f(e){let{comment:s,onLike:t,onReply:a,onReplyLike:r}=e,[n,c]=(0,i.useState)(!1),[d,o]=(0,i.useState)(!0),{isAuthenticated:m}=(0,u.w)(),{openLoginModal:x}=(0,h.X)(),f=e=>{if(!m)return void x();r(e)},g=e=>e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/");return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[g(s.author.profileImage)?(0,l.jsx)("img",{src:s.author.profileImage,alt:s.author.name,className:"w-8 h-8 rounded-full flex-shrink-0"}):(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex-shrink-0 bg-gray-100 border border-gray-200 flex items-center justify-center text-base",children:s.author.profileImage}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"flex items-center space-x-2 text-sm",children:(0,l.jsx)("span",{className:"font-medium text-gray-900",children:s.author.name})}),(0,l.jsx)("p",{className:"mt-1 text-gray-900 whitespace-pre-wrap",children:s.content}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,l.jsxs)("button",{onClick:()=>{if(!m)return void x();t(s.id)},className:"flex items-center space-x-1 text-sm transition-colors ".concat(s.isLiked?"text-blue-600":"text-gray-500 hover:text-gray-700"),children:[(0,l.jsx)("svg",{className:"w-4 h-4",fill:s.isLiked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.60L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L9 7v13m-3-4h-2m-2-2h2m2-4h2m2-2h2"})}),(0,l.jsx)("span",{children:s.likeCount})]}),(0,l.jsx)("button",{onClick:()=>c(!n),className:"text-sm text-gray-500 hover:text-gray-700 transition-colors",children:"답글"})]})]})]}),n&&(0,l.jsx)("div",{className:"ml-11",children:(0,l.jsx)(p,{onSubmit:e=>{a(s.id,e),c(!1)},placeholder:"답글을 입력하세요...",isReply:!0})}),s.replies&&s.replies.length>0&&(0,l.jsxs)("div",{className:"ml-11 space-y-4",children:[(0,l.jsxs)("button",{onClick:()=>o(!d),className:"flex items-center space-x-1 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:[(0,l.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),(0,l.jsx)("span",{children:d?"답글 숨기기":"답글 ".concat(s.replies.length,"개 보기")})]}),d&&(0,l.jsx)("div",{className:"space-y-4",children:s.replies.map(e=>(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[g(e.author.profileImage)?(0,l.jsx)("img",{src:e.author.profileImage,alt:e.author.name,className:"w-6 h-6 rounded-full flex-shrink-0"}):(0,l.jsx)("div",{className:"w-6 h-6 rounded-full flex-shrink-0 bg-gray-100 border border-gray-200 flex items-center justify-center text-sm",children:e.author.profileImage}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"flex items-center space-x-2 text-sm",children:(0,l.jsx)("span",{className:"font-medium text-gray-900",children:e.author.name})}),(0,l.jsx)("p",{className:"mt-1 text-gray-900 whitespace-pre-wrap",children:e.content}),(0,l.jsx)("div",{className:"flex items-center space-x-4 mt-2",children:(0,l.jsxs)("button",{onClick:()=>f(e.id),className:"flex items-center space-x-1 text-sm transition-colors ".concat(e.isLiked?"text-blue-600":"text-gray-500 hover:text-gray-700"),children:[(0,l.jsx)("svg",{className:"w-3 h-3",fill:e.isLiked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.60L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L9 7v13m-3-4h-2m-2-2h2m2-4h2m2-2h2"})}),(0,l.jsx)("span",{children:e.likeCount})]})})]})]},e.id))})]})]})}function g(e){let{comments:s,onLike:t,onReply:i,onReplyLike:a}=e;return 0===s.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)("p",{children:"아직 댓글이 없습니다."}),(0,l.jsx)("p",{className:"text-sm mt-2",children:"첫 번째 댓글을 작성해보세요!"})]}):(0,l.jsx)("div",{className:"space-y-6",children:s.map(e=>(0,l.jsx)(f,{comment:e,onLike:t,onReply:i,onReplyLike:a},e.id))})}var j=t(56546);function v(e){let{debateId:s,hasVote:t}=e,[a,r]=(0,i.useState)([]),[n,c]=(0,i.useState)(!0),[d,o]=(0,i.useState)(null),{user:m,isAuthenticated:x}=(0,u.w)();async function h(){try{c(!0),o(null);let e=(await (0,j.p4)(s,0,20)).comments.map(e=>{var s,t,l,i;return{id:e.id,author:{name:null!=(l=null==(s=e.writer)?void 0:s.nickname)?l:"익명",profileImage:null!=(i=null==(t=e.writer)?void 0:t.profileEmoji)?i:"\uD83D\uDE42"},content:e.content,likeCount:e.likeCount,isLiked:e.liked,replies:e.childComments.map(s=>{var t,l,i,a;return{id:s.id,author:{name:null!=(i=null==(t=s.writer)?void 0:t.nickname)?i:"익명",profileImage:null!=(a=null==(l=s.writer)?void 0:l.profileEmoji)?a:"\uD83D\uDE42"},content:s.content,likeCount:s.likeCount,isLiked:s.liked,parentCommentId:e.id}})}});r(e)}catch(e){o(e instanceof Error?e.message:"알 수 없는 오류")}finally{c(!1)}}(0,i.useEffect)(()=>{!0===t?h():!1===t&&(r([]),o("NOT_VOTED"),c(!1))},[s,t]);let f=async e=>{try{let{commentId:t}=await (0,j.eT)(s,e,null),l={id:t,author:{name:x&&(null==m?void 0:m.nickname)?m.nickname:"익명",profileImage:x&&(null==m?void 0:m.profileEmoji)?m.profileEmoji:"\uD83D\uDE42"},content:e,likeCount:0,isLiked:!1,replies:[]};r(e=>[l,...e])}catch(e){"NOT_VOTED"===e.message?o("NOT_VOTED"):"NOT_FOUND_DEBATE"===e.message?o("존재하지 않는 토론입니다."):o(e.message||"댓글 작성에 실패했습니다."),await h()}},v=async e=>{let s=a.find(s=>s.id===e),t=!!(null==s?void 0:s.isLiked);r(s=>s.map(s=>s.id===e?{...s,isLiked:!s.isLiked,likeCount:s.isLiked?s.likeCount-1:s.likeCount+1}:s));try{t?await (0,j.i9)(e):await (0,j.tT)(e)}catch(s){r(s=>s.map(s=>s.id===e?{...s,isLiked:t,likeCount:t?s.likeCount+1:s.likeCount-1}:s)),"NOT_VOTED"===s.message?o("NOT_VOTED"):"NOT_FOUND_COMMENT"===s.message?o("댓글을 찾을 수 없습니다."):"ALREADY_LIKED_COMMENT"===s.message||o(s.message||"댓글 좋아요에 실패했습니다.")}},N=async(e,t)=>{try{let{commentId:l}=await (0,j.eT)(s,t,e);r(s=>s.map(s=>s.id===e?{...s,replies:[...s.replies||[],{id:l,author:{name:x&&(null==m?void 0:m.nickname)?m.nickname:"익명",profileImage:x&&(null==m?void 0:m.profileEmoji)?m.profileEmoji:"\uD83D\uDE42"},content:t,likeCount:0,isLiked:!1,parentCommentId:e}]}:s))}catch(e){"NOT_VOTED"===e.message?o("NOT_VOTED"):"NOT_FOUND_COMMENT"===e.message?o("부모 댓글을 찾을 수 없습니다."):"NOT_FOUND_DEBATE"===e.message?o("존재하지 않는 토론입니다."):o(e.message||"답글 작성에 실패했습니다."),await h()}},b=async e=>{let s=!1;r(t=>{for(let i of t){var l;let t=null==(l=i.replies)?void 0:l.find(s=>s.id===e);if(t){s=t.isLiked;break}}return t.map(s=>{var t;return{...s,replies:null==(t=s.replies)?void 0:t.map(s=>s.id===e?{...s,isLiked:!s.isLiked,likeCount:s.isLiked?s.likeCount-1:s.likeCount+1}:s)}})});try{s?await (0,j.i9)(e):await (0,j.tT)(e)}catch(t){r(t=>t.map(t=>{var l;return{...t,replies:null==(l=t.replies)?void 0:l.map(t=>t.id===e?{...t,isLiked:s,likeCount:s?t.likeCount+1:t.likeCount-1}:t)}})),"NOT_VOTED"===t.message?o("NOT_VOTED"):"NOT_FOUND_COMMENT"===t.message?o("댓글을 찾을 수 없습니다."):"ALREADY_LIKED_COMMENT"===t.message||o(t.message||"답글 좋아요에 실패했습니다.")}};return n?(0,l.jsx)("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:(0,l.jsx)("div",{className:"text-center py-8 text-gray-500",children:"로딩 중..."})}):"NOT_VOTED"===d?(0,l.jsx)("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:(0,l.jsx)("div",{className:"text-center py-8 text-gray-600",children:"투표 후에 댓글을 확인할 수 있습니다"})}):d?(0,l.jsx)("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:(0,l.jsx)("div",{className:"text-center py-8 text-red-500",children:d})}):(0,l.jsxs)("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,l.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["댓글 ",a.length,"개"]})}),(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsx)(p,{onSubmit:f})}),(0,l.jsx)(g,{comments:a,onLike:v,onReply:N,onReplyLike:b})]})}function N(e){let{message:s,type:t="success",isVisible:a,onClose:r}=e;return((0,i.useEffect)(()=>{if(a){let e=setTimeout(()=>{r()},3e3);return()=>clearTimeout(e)}},[a,r]),a)?(0,l.jsx)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50",children:(0,l.jsx)("div",{className:"".concat("success"===t?"bg-green-500":"bg-red-500"," text-white px-6 py-3 rounded-lg shadow-lg max-w-sm"),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:s}),(0,l.jsx)("button",{onClick:r,className:"ml-4 text-white hover:text-gray-200",children:"✕"})]})})}):null}function b(e){let{debateId:s}=e,[t,a]=(0,i.useState)(null),[n,c]=(0,i.useState)(null),[d,o]=(0,i.useState)(!0),[m,u]=(0,i.useState)(null),[h,p]=(0,i.useState)(null),[f,g]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[k,w]=(0,i.useState)({message:"",type:"success",isVisible:!1});(0,i.useEffect)(()=>{(async()=>{try{o(!0);let[e,t]=await Promise.all([(0,j.Bf)(s),(0,j.N2)(s)]);if(c(e),p(null==t?void 0:t.hasVote),null==t?void 0:t.hasVote){let e=await (0,j.xZ)(s);y(e),a("left")}}catch(e){u(e instanceof Error?e.message:"토론을 불러오는데 실패했습니다.")}finally{o(!1)}})()},[s]);let C=async e=>{if(!f&&!h){a(e),g(!0);try{await (0,j.H9)(s,"left"===e?"CHOICE_A":"CHOICE_B"),p(!0),w({message:"투표가 완료되었습니다!",type:"success",isVisible:!0});let t=await (0,j.xZ)(s);y(t)}catch(e){w({message:e instanceof Error?e.message:"투표에 실패했습니다.",type:"error",isVisible:!0}),a(null)}finally{g(!1)}}};return d?(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})})}):m?(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-red-500",children:m})})}):n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[(0,l.jsx)(r,{title:n.topic,thumbnail:n.thumbnailUrl,choiceA:n.choiceA,choiceB:n.choiceB,onSelectSide:C,selectedSide:t,hasVote:h,isVoting:f}),(0,l.jsxs)("div",{className:"relative",children:[null===t?(0,l.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-white/80 backdrop-blur-sm rounded-xl border-2 border-gray-200",children:(0,l.jsx)("p",{className:"text-lg font-medium text-gray-600",children:"투표 후에 결과를 확인할 수 있습니다"})}):null,(0,l.jsx)("div",{className:null===t?"pointer-events-none":"",children:(0,l.jsx)(x,{agreeCount:(null==b?void 0:b.choiceACount)||0,disagreeCount:(null==b?void 0:b.choiceBCount)||0})})]}),(0,l.jsx)(v,{debateId:parseInt(s),hasVote:h})]}),(0,l.jsx)(N,{message:k.message,type:k.type,isVisible:k.isVisible,onClose:()=>{w(e=>({...e,isVisible:!1}))}})]}):(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-gray-500",children:"토론을 찾을 수 없습니다."})})})}var y=t(44225);function k(){let e=(0,y.useSearchParams)().get("debateId");return e?(0,l.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,l.jsx)(a.Header,{title:"토론 주제"}),(0,l.jsx)(b,{debateId:e})]}):(0,l.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,l.jsx)(a.Header,{title:"토론 주제"}),(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-gray-500",children:"잘못된 접근입니다. debateId가 필요합니다."})})})]})}function w(){return(0,l.jsx)(i.Suspense,{fallback:(0,l.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,l.jsx)(a.Header,{title:"토론 주제"}),(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-gray-500",children:"로딩 중..."})})})]}),children:(0,l.jsx)(k,{})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[661,928,665,508,789,20,358],()=>s(35321)),_N_E=e.O()}]);